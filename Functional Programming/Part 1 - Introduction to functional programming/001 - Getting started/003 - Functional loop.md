# Функциональные циклы

```scala
def factorial(n: Int): Int = {
  @tailrec
  def go(n: Int, acc: Int): Int =
    if (n <= 0) acc
    else go(n - 1, n * acc)

  go(n, 1)
}

```

Функциональные циклы пишутся через рекурсивные функции. Таким образом достигается иммутабельность переменных. Если рекурсия хвостовая (*tail recursion*), Scala компилирует её в код как если бы это был цикл `while`. Такая рекурсия не потребляет фреймы стека на каждой итерации. 

Хостовая рекурсия - это когда вызывающая функция возвращает значение рекурсивного вызова, ничего с ним не делая после. Например, `1 + go(n,1)` уже не будет хвостовой рекурсией, так как после вычисления `go` произойдёт прибавление единицы.

Аннотация `@tailrec` позволяет проверить, является ли рекурсия хвостовой. Компилятор сообщит об ошибке, если это не так:

```scala
@tailrec
def nonTail(n: Int = 0): Int = {
  if (n > 0) n
  else 1 + nonTail(n + 1)
}

// could not optimize @tailrec annotated method nonTail: it is neither private nor final so can be overridden

```